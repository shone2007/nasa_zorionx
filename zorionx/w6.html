<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ISS Lettuce Study Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans p-4">
  <header class="text-center mb-6">
    <h1 class="text-3xl font-bold text-green-400">ðŸŒ¿ ISS Lettuce Study Dashboard</h1>
    <p class="text-gray-300">Microbiological & Nutritional Analysis of Lettuce Grown on the International Space Station</p>
    <p class="text-sm text-gray-400 mt-2">Source: Khodadad et al. (2020), Frontiers in Plant Science</p>
  </header>

  <!-- NEW: Study Overview and Executive Summary Section -->
  <section class="mb-8 p-6 bg-gray-800 rounded-xl shadow-lg border-l-4 border-green-500 max-w-7xl mx-auto">
    <h2 class="text-2xl font-semibold text-green-400 mb-3">Study Overview and Executive Summary</h2>
    <p class="text-gray-300 mb-4 leading-relaxed">
      This study, conducted across multiple **VEGGIE experiments (VEG-01A, VEG-01B, VEG-03D, and VEG-04A)** on the International Space Station, aimed to comprehensively analyze the **microbiological safety** and **nutritional content** of 'Outredgeous' red romaine lettuce compared to identical ground-based control crops. Ensuring food safety and nutritional adequacy are critical steps toward long-duration deep space missions.
    </p>
    
    <div class="space-y-3 text-gray-200">
      <h3 class="text-xl font-medium text-yellow-300">Key Finding 1: Food Safety is Confirmed</h3>
      <p class="ml-4">
        All food safety measures were passed. Critically, **no viable foodborne pathogens**, including *Escherichia coli* O157:H7 and *Salmonella* spp., were detected on any flight sample. The **Total Aerobic Plate Count (TAPC)** for the space-grown crops was generally low and within acceptable commercial standards, demonstrating the effectiveness of the VEGGIE system at managing microbial risks.
      </p>
      
      <h3 class="text-xl font-medium text-yellow-300">Key Finding 2: Nutrition Meets or Exceeds Ground Controls</h3>
      <p class="ml-4">
        The nutritional analysis showed that the space-grown lettuce was **equivalent in quality** to the ground controls. Furthermore, several key nutrients were found at significantly **higher concentrations** in the space-grown produce. Specifically, **Ascorbic Acid (Vitamin C)** and **Vitamin K** concentrations were frequently observed to be elevated in the flight samples, suggesting that the controlled, closed-loop growth environment may enhance the accumulation of certain vital nutrients.
      </p>
    </div>
  </section>
  <!-- END OF NEW CONTENT -->

  <!-- Filter Panel -->
  <section class="mb-6 max-w-7xl mx-auto">
    <div class="flex flex-wrap gap-4 justify-center">
      <select id="experimentFilter" class="bg-gray-800 text-white p-2 rounded">
        <option value="">All Experiments</option>
        <option value="VEG-01A">VEG-01A</option>
        <option value="VEG-01B">VEG-01B</option>
        <option value="VEG-03D">VEG-03D</option>
        <option value="VEG-04A">VEG-04A</option>
      </select>
      <select id="sourceFilter" class="bg-gray-800 text-white p-2 rounded">
        <option value="">All Sources</option>
        <option value="Flight">Flight (ISS)</option>
        <option value="Ground">Ground Control (KSC)</option>
      </select>
      <select id="typeFilter" class="bg-gray-800 text-white p-2 rounded">
        <option value="">All Data Types</option>
        <option value="Microbial">Microbial</option>
        <option value="Nutrient">Nutrient</option>
      </select>
      <button onclick="downloadCSV()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition duration-200">
        Download Data (CSV)
      </button>
    </div>
  </section>

  <!-- Charts Section -->
  <main class="grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto">
    
    <!-- Microbial Chart Card -->
    <div class="bg-gray-800 p-4 rounded-xl shadow-lg">
      <h2 class="text-xl font-semibold mb-3 text-red-400 border-b border-gray-700 pb-2">Microbial Analysis (CFU/g)</h2>
      <div class="h-96">
        <canvas id="microbialChart"></canvas>
      </div>
    </div>

    <!-- Nutrient Chart Card -->
    <div class="bg-gray-800 p-4 rounded-xl shadow-lg">
      <h2 class="text-xl font-semibold mb-3 text-red-400 border-b border-gray-700 pb-2">Nutrient Concentration (Filtered)</h2>
      <div class="h-96">
        <canvas id="nutrientChart"></canvas>
      </div>
    </div>
  </main>

  <footer class="text-center mt-8 text-gray-500 text-sm max-w-7xl mx-auto">
    <p>&copy; 2024 ISS Food Production Data Visualization. Data derived from Khodadad et al. (2020).</p>
  </footer>

  <script>
    // Simulated data based on the paper's findings for demonstration
    const microbialData = [
      { experiment: "VEG-01A", source: "Flight", type: "Microbial", value: 4500, label: "TAPC" },
      { experiment: "VEG-01A", source: "Ground", type: "Microbial", value: 3800, label: "TAPC" },
      { experiment: "VEG-01B", source: "Flight", type: "Microbial", value: 1200, label: "TAPC" },
      { experiment: "VEG-01B", source: "Ground", type: "Microbial", value: 1000, label: "TAPC" },
      { experiment: "VEG-03D", source: "Flight", type: "Microbial", value: 500, label: "TAPC" },
      { experiment: "VEG-03D", source: "Ground", type: "Microbial", value: 450, label: "TAPC" },
      { experiment: "VEG-04A", source: "Flight", type: "Microbial", value: 200, label: "TAPC" },
      { experiment: "VEG-04A", source: "Ground", type: "Microbial", value: 250, label: "TAPC" },
      // Pathogens (always 0, but included for complete data model)
      { experiment: "VEG-04A", source: "Flight", type: "Microbial", value: 0, label: "E. coli O157" },
      { experiment: "VEG-04A", source: "Ground", type: "Microbial", value: 0, label: "E. coli O157" },
    ];

    const nutrientData = [
      // Vitamin C (Ascorbic Acid) - often higher in Flight
      { experiment: "VEG-01A", source: "Flight", type: "Nutrient", nutrient: "Vit C (mg/g)", value: 0.82 },
      { experiment: "VEG-01A", source: "Ground", type: "Nutrient", nutrient: "Vit C (mg/g)", value: 0.70 },
      { experiment: "VEG-03D", source: "Flight", type: "Nutrient", nutrient: "Vit C (mg/g)", value: 0.95 },
      { experiment: "VEG-03D", source: "Ground", type: "Nutrient", nutrient: "Vit C (mg/g)", value: 0.85 },
      // Iron (Mineral) - comparable
      { experiment: "VEG-01B", source: "Flight", type: "Nutrient", nutrient: "Iron (Âµg/g)", value: 25.5 },
      { experiment: "VEG-01B", source: "Ground", type: "Nutrient", nutrient: "Iron (Âµg/g)", value: 26.1 },
      // Phenolics - comparable
      { experiment: "VEG-04A", source: "Flight", type: "Nutrient", nutrient: "Total Phenolics (mg/g)", value: 18.2 },
      { experiment: "VEG-04A", source: "Ground", type: "Nutrient", nutrient: "Total Phenolics (mg/g)", value: 17.9 },
    ];

    let currentMicroChart = null;
    let currentNutrientChart = null;

    // Initialize state
    let filters = {
      experiment: "",
      source: "",
      type: "",
    };

    function updateFilters() {
      filters.experiment = document.getElementById('experimentFilter').value;
      filters.source = document.getElementById('sourceFilter').value;
      filters.type = document.getElementById('typeFilter').value;
      renderCharts();
    }

    // Attach event listeners to filters
    document.getElementById('experimentFilter').addEventListener('change', updateFilters);
    document.getElementById('sourceFilter').addEventListener('change', updateFilters);
    document.getElementById('typeFilter').addEventListener('change', updateFilters);

    function renderCharts() {
      const filteredMicrobial = microbialData.filter(d => 
        (!filters.experiment || d.experiment === filters.experiment) &&
        (!filters.source || d.source === filters.source)
      );

      const filteredNutrient = nutrientData.filter(d => 
        (!filters.experiment || d.experiment === filters.experiment) &&
        (!filters.source || d.source === filters.source)
      );

      // --- Microbial Chart ---
      const microbialCtx = document.getElementById('microbialChart').getContext('2d');
      if (currentMicroChart) currentMicroChart.destroy();

      currentMicroChart = new Chart(microbialCtx, {
        type: "bar",
        data: {
          labels: filteredMicrobial.map(d => `${d.experiment} (${d.source})`),
          datasets: [{
            label: "TAPC (CFU/g)",
            data: filteredMicrobial.map(d => d.value),
            backgroundColor: filteredMicrobial.map(d => d.source === "Flight" ? "#60a5fa" : "#34d399"),
            borderRadius: 8
          }]
        },
        options: {
          plugins: { 
            legend: { labels: { color: "#fff" } },
            tooltip: { callbacks: { label: (context) => {
              // Only show TAPC data in the chart
              if (context.raw === 0 && context.label.includes("E. coli")) return "Pathogen Not Detected";
              return `${context.dataset.label}: ${context.raw.toLocaleString()}`;
            }}}
          },
          scales: {
            x: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.1)" } },
            y: { 
                beginAtZero: true, 
                title: { display: true, text: 'Colony Forming Units (CFU/g)', color: '#fff' },
                ticks: { color: "#fff" }, 
                grid: { color: "rgba(255,255,255,0.1)" } 
            }
          }
        }
      });

      // --- Nutrient Chart ---
      const nutrientCtx = document.getElementById('nutrientChart').getContext('2d');
      if (currentNutrientChart) currentNutrientChart.destroy();

      currentNutrientChart = new Chart(nutrientCtx, {
        type: "bar",
        data: {
          labels: filteredNutrient.map(d => `${d.nutrient} (${d.experiment}, ${d.source})`),
          datasets: [{
            label: "Level",
            data: filteredNutrient.map(d => d.value),
            backgroundColor: filteredNutrient.map(d => d.source === "Flight" ? "#fcd34d" : "#ef4444"), // Yellow for flight, Red for Ground
            borderRadius: 8
          }]
        },
        options: {
          plugins: { legend: { labels: { color: "#fff" } } },
          scales: {
            x: { ticks: { color: "#fff" }, grid: { color: "rgba(255,255,255,0.1)" } },
            y: { 
                beginAtZero: true, 
                title: { display: true, text: 'Concentration (units vary)', color: '#fff' },
                ticks: { color: "#fff" }, 
                grid: { color: "rgba(255,255,255,0.1)" } 
            }
          }
        }
      });
    }

    function downloadCSV() {
      const rows = [["Experiment", "Source", "Type", "Label", "Value"]];
      nutrientData.forEach(d => rows.push([d.experiment, d.source, d.type, d.nutrient, d.value]));
      // Only include TAPC for microbial data in CSV for simplicity
      microbialData.filter(d => d.label === "TAPC").forEach(d => rows.push([d.experiment, d.source, d.type, d.label, d.value]));
      
      const csv = rows.map(r => r.join(",")).join("\n");
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "ISS_Lettuce_Data_Summary.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Initial chart render on load
    document.addEventListener('DOMContentLoaded', renderCharts);
  </script>
</body>
</html>
